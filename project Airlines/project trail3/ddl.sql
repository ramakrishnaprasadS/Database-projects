

show databases;

use airlines3;

CREATE TABLE AIRPORT(
AIRPORT_CODE VARCHAR(25),
AIRPORT_NAME VARCHAR(100) NOT NULL,
CITY VARCHAR(50) NOT NULL,
COUNTRY VARCHAR(50) NOT NULL,
CONSTRAINT AIRPORT_PK PRIMARY KEY (AIRPORT_CODE)
);



CREATE TABLE AIRLINES(
AIRLINES_ID VARCHAR(50) ,
AIRLINES_NAME VARCHAR(100) NOT NULL,
CONSTRAINT AIRLINES_PK PRIMARY KEY (AIRLINES_ID)
);



CREATE TABLE AIRPLANE(
AIRPLANE_NO VARCHAR(25) ,
SEATING_CAPACITY INTEGER NOT NULL,
AIRLINES_ID VARCHAR(50) NOT NULL,
CONSTRAINT AIRPLANE_PK PRIMARY KEY (AIRPLANE_NO),
CONSTRAINT PLANE_AIRLINES_FK FOREIGN KEY (AIRLINES_ID) REFERENCES AIRLINES(AIRLINES_ID)
);


ALTER TABLE AIRPLANE ADD COLUMN PLANE_MODEL VARCHAR(15) NOT NULL;


CREATE TABLE PLANE_PORT_ACCESS(
AIRPORT_CODE VARCHAR(25) NOT NULL,
AIRPLANE VARCHAR(25) NOT NULL,
CONSTRAINT ACCESS_PK PRIMARY KEY (AIRPORT_CODE,AIRPLANE),
CONSTRAINT ACCESS_PORT_FK FOREIGN KEY (AIRPORT_CODE) REFERENCES AIRPORT(AIRPORT_CODE) ON DELETE CASCADE,
CONSTRAINT ACCESS_PLANE_FK FOREIGN KEY (AIRPLANE) REFERENCES AIRPLANE(AIRPLANE_NO) ON DELETE CASCADE
);

ALTER TABLE PLANE_PORT_ACCESS RENAME COLUMN AIRPLANE TO AIRPLANE_NO;
ALTER TABLE PLANE_PORT_ACCESS ADD COLUMN IS_ALLOWED VARCHAR(10);



CREATE TABLE SEAT(
AIRPLANE_NO VARCHAR(25) NOT NULL,
SEAT_NO VARCHAR(5) NOT NULL,
AVAILABILITY VARCHAR(10) DEFAULT 'TRUE',
LOCATION VARCHAR(25) NOT NULL,
SEAT_CLASS VARCHAR(25) NOT NULL,
CONSTRAINT SEAT_PK PRIMARY KEY (AIRPLANE_NO,SEAT_NO),
CONSTRAINT SEAT_PLANE_FK FOREIGN KEY (AIRPLANE_NO) REFERENCES AIRPLANE(AIRPLANE_NO) ON DELETE CASCADE
);

ALTER TABLE SEAT DROP COLUMN LOCATION;
ALTER TABLE SEAT MODIFY column seat_no varchar(15);





CREATE TABLE USER (
USER_EMAIL VARCHAR(25) ,
NAME VARCHAR(50) NOT NULL,
PHONE VARCHAR(15) ,
TYPE_OF_USER VARCHAR(25) NOT NULL,
CONSTRAINT USER_PK PRIMARY KEY (USER_EMAIL)
);

INSERT INTO USER VALUES
('kunal.jagdish@gmail.com','Kunal','4694529484','NORMAL' ),
('kxa142230@utdallas.edu','Kunal','4694529484','NORMAL' ),
('shobhit@gmail.com','Shobhit','4694527474','NORMAL' ),
('indervirsingh@gmail.com' ,'Indervir','4694528585','NORMAL' ),
( 'bala@yahoo.com' ,'Bala','4694529595','AGENT');


CREATE TABLE TRAVELLER(
TRAVELLER_ID INTEGER AUTO_INCREMENT,
PHONE VARCHAR(15),
NAME VARCHAR(50) NOT NULL,
COUNTRY VARCHAR(50) NOT NULL,
CONSTRAINT TRAVELLER_PK PRIMARY KEY(TRAVELLER_ID)
);



INSERT INTO TRAVELLER(PHONE,NAME,COUNTRY) VALUES
('4567891231','Kunal','USA' ),
('4567891241','Indervir','USA' ),
('4567891274','Bala','INDIA' ),
('4567891278','Shobhi','UK'),
('4567891214','Nitish','UK' );

CREATE TABLE FLIGHT_TRIP(
FLIGHT_TRIP_ID VARCHAR(15) ,
NO_OF_TRAVELLERS INTEGER NOT NULL,
ARRIVAL_AIRPORT_CODE VARCHAR(25) NOT NULL,
ARRIVAL_TIME DATETIME NOT NULL,
DEPART_AIRPORT_CODE VARCHAR(25) NOT NULL,
DEPART_TIME DATETIME NOT NULL,
USER_EMAIL VARCHAR(25) NOT NULL,
CONSTRAINT FLIGHT_TRIP_PK PRIMARY KEY (FLIGHT_TRIP_ID),
CONSTRAINT FLGHT_TRIP_USER_FK FOREIGN KEY (USER_EMAIL) REFERENCES USER(USER_EMAIL),
CONSTRAINT FLGHT_TRIP_ARRPORT_FK FOREIGN KEY (ARRIVAL_AIRPORT_CODE) REFERENCES AIRPORT(AIRPORT_CODE),
CONSTRAINT FLGHT_TRIP_DPTPORT_FK FOREIGN KEY (DEPART_AIRPORT_CODE) REFERENCES AIRPORT(AIRPORT_CODE)
);

INSERT INTO FLIGHT_TRIP VALUES
('kunish17dec',1,'RDU',"2023-01-30 6:00:00",'CLT',"2023-01-30 8:00:00",'kunal.jagdish@gmail.com' ), 
('kuniaa741',1,'CLT',"2023-01-30 9:00:00",'DAL',"2023-01-30 12:00:00",'kunal.jagdish@gmail.com' ),
('inder17dec',1,'RDU',"2023-01-30 13:00:00",'DFW',"2023-01-30 16:00:00",'indervirsingh@gmail.com' ) ,
('shoaga17dec',1,'RDU',"2023-01-30 18:00:00",'DFW',"2023-01-30 20:00:00",'shobhit@gmail.com' ),
('bala17dec',1,'DFW',"2023-01-30 22:00:00",'LAX',"2023-01-30 23:50:00",'bala@yahoo.com' );

CREATE TABLE ROUTES(
ROUTE_ID VARCHAR(15) ,
DISTANCE DECIMAL(7,2) NOT NULL,
BASE_FARE DECIMAL(9,2) NOT NULL,
AIRPLANE_NO VARCHAR(25) NOT NULL,
ARRIVAL_AIRPORT_CODE VARCHAR(25) NOT NULL,
ARRIVAL_TIME DATE NOT NULL,
DEPART_AIRPORT_CODE VARCHAR(25) NOT NULL,
DEPART_TIME DATE NOT NULL,
CONSTRAINT ROUTES_PK PRIMARY KEY (ROUTE_ID),
CONSTRAINT ROUTES_APLNE_FK FOREIGN KEY (AIRPLANE_NO) REFERENCES AIRPLANE(AIRPLANE_NO),
CONSTRAINT ROUTES_ARVL_ARPRT_FK FOREIGN KEY(ARRIVAL_AIRPORT_CODE) REFERENCES AIRPORT(AIRPORT_CODE),
CONSTRAINT ROUTES_DRPT_ARPRT_FK FOREIGN KEY(DEPART_AIRPORT_CODE) REFERENCES AIRPORT(AIRPORT_CODE)
);

INSERT INTO ROUTES VALUES
('AX7458',600,200,'AA751','RDU', "2023-01-30 6:00:00",'DFW',"2023-01-30 8:00:00"),
( 'AX7459',600,200,'AA851','RDU',"2023-01-30 10:00:00",'DAL',"2023-01-30 12:00:00"),
( 'AX7460',600,200,'AA751','RDU',"2023-01-30 14:00:00",'LAX',"2023-01-30 16:00:00"),
( 'AX7461',600,200,'AA751','RDU',"2023-01-30 20:00:00",'CLT',"2023-01-30 22:00:00"),
( 'AX7462',600,200,'AA751','DFW',"2023-01-30 23:00:00",'CLT',"2023-01-30 23:05:00");

CREATE TABLE ROUTES_TRIPS(
ROUTE_ID VARCHAR(25) NOT NULL,
FLIGHT_TRIP_ID VARCHAR(15) NOT NULL,
CONSTRAINT ROUTES_TRIPS_FT_PK PRIMARY KEY 
(ROUTE_ID,FLIGHT_TRIP_ID),
CONSTRAINT ROUTES_TRIPS_TID_FK FOREIGN KEY (ROUTE_ID) REFERENCES ROUTES(ROUTE_ID),
CONSTRAINT ROUTES_TRIPS_FT_FK FOREIGN KEY(FLIGHT_TRIP_ID) REFERENCES FLIGHT_TRIP(FLIGHT_TRIP_ID) ON DELETE CASCADE
);

INSERT INTO ROUTES_TRIPS VALUES
( 'AX7458','kunish17dec' ),
( 'AX7459','kuniaa741' ),
( 'AX7458','inder17dec' ),
( 'AX7458','shoaga17dec' ),
( 'AX7460','bala17dec'); 

CREATE TABLE FARE(
FLIGHT_TRIP_ID VARCHAR(15) ,
FINAL_AMOUNT DECIMAL(9,2) NOT NULL,
AMOUNT DECIMAL(9,2) NOT NULL,
CURRENCY VARCHAR(5) NOT NULL,
DISCOUNT DECIMAL(4,2) NOT NULL,
TAX DECIMAL(5,2) NOT NULL,
CONSTRAINT FARE_PK PRIMARY KEY (FLIGHT_TRIP_ID),
CONSTRAINT FARE_FLT_TRIP_FK FOREIGN KEY (FLIGHT_TRIP_ID) REFERENCES FLIGHT_TRIP(FLIGHT_TRIP_ID) ON DELETE CASCADE
);

INSERT INTO FARE VALUES
( 'kunish17dec',176,200,'$',10,10 ),
( 'kuniaa741',176,200,'$',10,10 ),
( 'inder17dec',176,200,'$',10,10 ),
( 'shoaga17dec',176,200,'$',10,10 ),
( 'bala17dec',176,200,'$',10,10);

CREATE TABLE TRAVELLER_TICKET(
FLIGHT_TRIP_ID VARCHAR(15) NOT NULL,
TRAVELLER_ID INTEGER ,
SEAT_NO VARCHAR(5),
AIRPLANE_NO VARCHAR(25),
CONSTRAINT TRVLR_TCKT_PK PRIMARY KEY 
(FLIGHT_TRIP_ID,SEAT_NO,AIRPLANE_NO),
CONSTRAINT TRVLR_FLT_TRIP_FK FOREIGN KEY (FLIGHT_TRIP_ID) REFERENCES FLIGHT_TRIP(FLIGHT_TRIP_ID) ON DELETE CASCADE,
CONSTRAINT TRVLR_SEAT_FK FOREIGN KEY(AIRPLANE_NO,SEAT_NO) REFERENCES SEAT(AIRPLANE_NO,SEAT_NO),
CONSTRAINT TRVLR_ID_FK FOREIGN KEY(TRAVELLER_ID) REFERENCES TRAVELLER(TRAVELLER_ID)
);

INSERT INTO TRAVELLER_TICKET VALUES
( 'kunish17dec',2,'A23','AA751' ),
( 'kuniaa741',1,'A24','AA751' ),
( 'inder17dec',3,'A25','AA751' ),
( 'shoaga17dec',4,'A23','AA851' ),
( 'bala17dec',5,'A24','AA851' );






