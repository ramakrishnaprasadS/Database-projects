-- Active: 1671708805339@@127.0.0.1@3308@ram_db

CREATE DATABASE IF NOT EXISTS `Airlinesdb_new` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
use Airlinesdb_new;
show tables;

------------------------AIRPORT:
CREATE TABLE AIRPORT(
AIRPORT_CODE VARCHAR(25),
AIRPORT_NAME VARCHAR(100) NOT NULL,
LOCATION VARCHAR(50) NOT NULL,
CITY VARCHAR(50) NOT NULL,
AP_STATE VARCHAR(50) NOT NULL,
COUNTRY VARCHAR(50) NOT NULL,
ZIP INT UNSIGNED NOT NULL
);

ALTER TABLE AIRPORT ADD CONSTRAINT AIRPORT_PK PRIMARY KEY (AIRPORT_CODE);

INSERT 
INTO AIRPORT VALUES
( 'DFW' , 'Dallas/Fort Worth International Airport','3200 E Airfield Dr','Dallas','Texas','USA',75261),
( 'DAL' , 'Dallas Love Field Airport', '8008 CedarSprings Rd','Dallas','Texas','USA',75235),
( 'RDU' , 'Raleigh-Durham International Airport','2400 John Brantley Blvd, Morrisville','Raleigh','NC','USA',27560),
( 'CLT' , 'Charlotte Douglas International Airport','5501 R C Josh Birmingham Pkwy','Charlotte','NC','USA',28208),
( 'LAX' , 'Los Angeles International Airport', '1 WorldWay','Los Angels','CA','USA',90045);



------------------------------------------Airline company

CREATE TABLE AIRLINES(
AIRLINES_ID VARCHAR(50) ,
AIRLINES_NAME VARCHAR(100) NOT NULL
);
ALTER TABLE AIRLINES ADD CONSTRAINT COMPANY_PK PRIMARY KEY (AIRLINES_ID);

INSERT INTO AIRLINES VALUES
( 'AA' , 'American Airlines'),
( 'BA' , 'British Airways'),
( 'EX' , 'Atlantic Airlines'),
( 'JET' , 'Jet Airways'),
( 'SJ' , 'Spice Jet');




---------------------------AIRPLANE:

CREATE TABLE AIRPLANE(
AIRPLANE_NO VARCHAR(25) ,
SEATING_CAPACITY INT UNSIGNED NOT NULL,
AIRLINES_ID VARCHAR(50) NOT NULL
);

ALTER TABLE AIRPLANE ADD CONSTRAINT AIRPLANE_PK PRIMARY KEY (AIRPLANE_NO);
ALTER TABLE AIRPLANE ADD CONSTRAINT PLANE_COMPANY_FK FOREIGN KEY (AIRLINES_ID) REFERENCES AIRLINES(AIRLINES_ID);

INSERT INTO AIRPLANE VALUES
( 'AA751' , 40, 'AA' ),
( 'AA851' , 60, 'AA' ),
( 'EX100' , 40, 'EX' ),
( 'JET785' , 60, 'JET' ),
( 'BA747' , 40, 'BA' );




---------------------------------PLANE PORT ACCESS:------------------------

CREATE TABLE PLANE_PORT_ACCESS(
AIRPORT_CODE VARCHAR(25) NOT NULL,
AIRPLANE_NO VARCHAR(25) NOT NULL
);

ALTER TABLE PLANE_PORT_ACCESS ADD CONSTRAINT ACCESS_PK PRIMARY KEY (AIRPORT,AIRPLANE);
ALTER TABLE PLANE_PORT_ACCESS ADD CONSTRAINT ACCESS_PORT_FK FOREIGN KEY (AIRPORT_CODE) REFERENCES AIRPORT(AIRPORT_CODE) ON DELETE CASCADE;
ALTER TABLE PLANE_PORT_ACCESS ADD CONSTRAINT ACCESS_PLANE_FK FOREIGN KEY (AIRPLANE_NO) REFERENCES AIRPLANE(AIRPLANE_NO) ON DELETE CASCADE;

INSERT INTO PLANE_PORT_ACCESS VALUES
( 'DFW','AA751' ),
( 'RDU','AA751' ),
( 'CLT','AA751' ),
( 'DFW','AA851' ),
( 'CLT','AA851' );



-----------------------------------------SEAT:

CREATE TABLE SEAT(
AIRPLANE_NO VARCHAR(25) NOT NULL,
SEAT_NO VARCHAR(5) NOT NULL,
AVAILABILITY VARCHAR(10) DEFAULT 'TRUE',
LOCATION VARCHAR(25) NOT NULL,
SEAT_CLASS VARCHAR(25) NOT NULL
);

ALTER TABLE SEAT ADD CONSTRAINT SEAT_PK PRIMARY KEY (AIRPLANE_NO,SEAT_NO);
ALTER TABLE SEAT ADD CONSTRAINT SEAT_PLANE_FK FOREIGN KEY (AIRPLANE_NO) REFERENCES AIRPLANE(AIRPLANE_NO) ON DELETE CASCADE;

INSERT INTO SEAT VALUES
( 'AA751','A23','TRUE','WINDOW','ECONOMIC' ),
( 'AA751' ,'A24','TRUE','WINDOW','ECONOMIC' ),
( 'AA751' ,'A25','TRUE','WINDOW','ECONOMIC' ),
( 'AA851' ,'A23','TRUE','WINDOW','ECONOMIC' ),
( 'AA851' ,'A24','TRUE','WINDOW','ECONOMIC' );


--------------------------USER:

CREATE TABLE END_USER (
EMAIL VARCHAR(25) ,
FNAME VARCHAR(25) NOT NULL,
LNAME VARCHAR(25) NOT NULL,
PHONE BIGINT UNSIGNED,
TYPE_OF_USER VARCHAR(25) NOT NULL
);


ALTER TABLE END_USER ADD CONSTRAINT USER_PK PRIMARY KEY (EMAIL);

INSERT INTO END_USER VALUES
('kunal.jagdish@gmail.com','Kunal','Arora',4694529483,'NORMAL' ),
('kxa142230@utdallas.edu','Kunal','Arora',4694529484,'NORMAL' ),
('shobhit@gmail.com','Shobhit','Agrawal',4694527474,'NORMAL' ),
('indervirsingh@gmail.com' ,'Indervir','Singh',4694528585,'NORMAL' ),
( 'bala@yahoo.com' ,'Bala','Yadav',4694529595,'AGENT' );



----------------FLIGHT_TRIP:

CREATE TABLE FLIGHT_TRIP(
FLIGHT_TRIP_ID VARCHAR(15) ,
NO_OF_TRAVELLERS INT UNSIGNED NOT NULL,
ARRIVAL_AIRPORT VARCHAR(25) NOT NULL,
ARRIVAL_TIME DATE NOT NULL,
DEPART_AIRPORT VARCHAR(25) NOT NULL,
DEPART_TIME DATE NOT NULL,
EMAIL VARCHAR(25) NOT NULL
);
ALTER TABLE FLIGHT_TRIP ADD CONSTRAINT FLIGHT_TRIP_PK PRIMARY KEY(FLIGHT_TRIP_ID);
ALTER TABLE FLIGHT_TRIP ADD CONSTRAINT FLIGHT_TRIP_USER_FK FOREIGN KEY(EMAIL) REFERENCES END_USER(EMAIL);

INSERT INTO FLIGHT_TRIP VALUES
('kunish17dec',1,'RDU',timestamp('2014/12/27 12:00:00'),'DFW',timestamp('2014/12/26 12:00:00'),'kunal.jagdish@gmail.com' ),
('kuniaa741',1,'RDU',timestamp('2014/12/27 12:00:00'),'DAL',timestamp('2014/12/26 12:00:00'),'kunal.jagdish@gmail.com' ),
('inder17dec',1,'RDU',timestamp('2014/12/27 12:00:00') ,'DFW',timestamp('2014/12/26 12:00:00'),'indervirsingh@gmail.com' ),
('shoaga17dec',1,'RDU',timestamp('2014/12/27 12:00:00'),'DFW',timestamp('2014/12/26 12:00:00'),'shobhit@gmail.com' ),
('bala17dec',1,'DFW',timestamp('2014/12/27 12:00:00'),'LAX',timestamp('2014/12/26 12:00:00'),'bala@yahoo.com' );


----------------------------FARE:

CREATE TABLE FARE(
FLIGHT_TRIP_ID VARCHAR(15) ,
FINAL_AMOUNT DECIMAL(9,2) NOT NULL,
AMOUNT DECIMAL(9,2) UNSIGNED NOT NULL,
CURRENCY VARCHAR(5) NOT NULL,
DISCOUNT DECIMAL(4,2) UNSIGNED NOT NULL,
TAX DECIMAL(5,2) UNSIGNED NOT NULL
);
ALTER TABLE FARE ADD CONSTRAINT FARE_PK PRIMARY KEY (FLIGHT_TRIP_ID);
ALTER TABLE FARE ADD CONSTRAINT FARE_FLT_TRIP_FK FOREIGN KEY(FLIGHT_TRIP_ID) REFERENCES FLIGHT_TRIP(FLIGHT_TRIP_ID) ON DELETE CASCADE;

INSERT INTO FARE VALUES
( 'kunish17dec',176,200,'$',10,10 ),
( 'kuniaa741',176,200,'$',10,10 ),
( 'inder17dec',176,200,'$',10,10 ),
( 'shoaga17dec',176,200,'$',10,10 ),
( 'bala17dec',176,200,'$',10,10 );

 ------------------------TRAVELLER:

CREATE TABLE TRAVELLER(
ID BIGINT,
PHONE BIGINT,
FNAME VARCHAR(25) NOT NULL,
LNAME VARCHAR(25) NOT NULL
);

ALTER TABLE TRAVELLER ADD CONSTRAINT TRAVELLER_PK PRIMARY KEY(ID);


INSERT INTO TRAVELLER VALUES
(10000001,4567891231,'Kunal','Arora' ),
(10000002,4567891241,'Indervir','Singh' ),
(10000003,4567891274,'Bala','Yadav' ),
(10000004,4567891278,'Shobhi','Agrawal'),
(10000005,4567891214,'Nitish','Salwan' );


--------------------TRAVELLER_TICKET:
CREATE TABLE TRAVELLER_TICKET(
FLIGHT_TRIP_ID VARCHAR(15) NOT NULL,
TICKET_ID VARCHAR(15),
SEAT_NO VARCHAR(5),
AIRPLANE_NO VARCHAR(25),
ID BIGINT UNSIGNED
);



ALTER TABLE TRAVELLER_TICKET ADD CONSTRAINT TRAVELLER_PKK PRIMARY KEY(FLIGHT,SEAT_NO,AIRPLANE_NO);
ALTER TABLE TRAVELLER_TICKET ADD CONSTRAINT TRVLR_FLT_TRIP_FK FOREIGN KEY (FLIGHT_TRIP_ID) REFERENCES FLIGHT_TRIP(FLIGHT_TRIP_ID) ON DELETE CASCADE;
ALTER TABLE TRAVELLER_TICKET ADD CONSTRAINT TRVLR_SEAT_FK FOREIGN KEY(AIRPLANE_NO,SEAT_NO) REFERENCES SEAT(AIRPLANE_NO,SEAT_NO);
ALTER TABLE TRAVELLER_TICKET ADD CONSTRAINT TRVLR_ID_FK FOREIGN KEY(ID) REFERENCES TRAVELLER(ID);

INSERT TRAVELLER_TICKET VALUES
( 'kunish17dec',2,'A23','AA751' ),
( 'kuniaa741',6,'A24','AA751' ),
( 'inder17dec',3,'A25','AA751' ),
( 'shoaga17dec',4,'A23','AA851' ),
( 'bala17dec',5,'A24','AA851' );

----------------------------------------ARS:

CREATE TABLE Airplane_Routes_Schedule(
ARS_ID VARCHAR(15) ,
DISTANCE DECIMAL(7,2) UNSIGNED NOT NULL,
BASE_FARE DECIMAL(9,2) UNSIGNED NOT NULL,
AIRPLANE_NO VARCHAR(25) NOT NULL,
ARRIVAL_AIRPORT VARCHAR(25) NOT NULL,
ARRIVAL_TIME DATE NOT NULL,
DEPART_AIRPORT VARCHAR(25) NOT NULL,
DEPART_TIME DATE NOT NULL
);

ALTER TABLE Airplane_Routes_Schedule ADD CONSTRAINT ARS_PK PRIMARY KEY (ARS_ID);
ALTER TABLE Airplane_Routes_Schedule ADD CONSTRAINT ARS_APLNE_FK FOREIGN KEY (AIRPLANE_NO) REFERENCES AIRPLANE(AIRPLANE_NO);
ALTER TABLE Airplane_Routes_Schedule ADD CONSTRAINT ARS_ARVL_ARPRT_FK FOREIGN KEY(ARRIVAL_AIRPORT) REFERENCES AIRPORT(AIRPORT_CODE);
ALTER TABLE Airplane_Routes_Schedule ADD CONSTRAINT ARS_DRPT_ARPRT_FK FOREIGN KEY(DEPART_AIRPORT) REFERENCES AIRPORT(AIRPORT_CODE);

INSERT INTO Airplane_Routes_Schedule VALUES
('AX7458',600,200,'AA751','RDU',timestamp('2014/12/27 12:00:00'),'DFW',timestamp('2014/12/26 12:00:00') ),
( 'AX7459',600,200,'AA851','RDU',timestamp('2014/12/27 12:00:00'),'DAL',timestamp('2014/12/26 12:00:00') ),
( 'AX7460',600,200,'AA751','RDU',timestamp('2014/12/27 12:00:00'),'LAX',timestamp('2014/12/26 12:00:00') ),
( 'AX7461',600,200,'AA751','RDU',timestamp('2014/12/27 12:00:00'),'CLT',timestamp('2014/12/26 12:00:00') ),
( 'AX7462',600,200,'AA751','DFW',timestamp('2014/12/27 12:00:00'),'CLT',timestamp('2014/12/26 12:00:00') );


--------------AFT:

CREATE TABLE Airplane_Flight_Trips(
ARS_ID VARCHAR(25) NOT NULL,
FLIGHT_TRIP_ID VARCHAR(15) NOT NULL
);
ALTER TABLE Airplane_Flight_Trips ADD CONSTRAINT ARS_AFT_FT_PK PRIMARY KEY(ARS_ID,FLIGHT_TRIP);
ALTER TABLE Airplane_Flight_Trips ADD CONSTRAINT ARS_AFT_FK FOREIGN KEY (ARS_ID) REFERENCES Airplane_Routes_Schedule(ARS_ID);
ALTER TABLE Airplane_Flight_Trips ADD CONSTRAINT FT_AFT_FK FOREIGN KEY(FLIGHT_TRIP_ID) REFERENCES FLIGHT_TRIP(FLIGHT_TRIP_ID) ON DELETE CASCADE;

INSERT INTO Airplane_Flight_Trips VALUES
( 'AX7458','kunish17dec' ),
( 'AX7459','kuniaa741' ),
( 'AX7458','inder17dec' ),
( 'AX7458','shoaga17dec' ),
( 'AX7460','bala17dec' );

----------------------------------------------------------------------------------------------------

--Simple SQL Select query:
SELECT FNAME, LNAME FROM TRAVELLER WHERE ID IN (SELECT ID
FROM TRAVELLER_ITINERARY WHERE FLIGHT='kunish17dec');
--Example of GROUP BY & aggregate function:
SELECT USER_EMAIL, COUNT (NO_OF_TRAVELLERS) FROM
FLIGHT_TRIP WHERE USER_EMAIL IN (SELECT EMAIL FROM
END_USER WHERE TYPE_OF_USER ='NORMAL') GROUP BY
USER_EMAIL;
----Example of JOIN:
SELECT * FROM FLIGHT_TRIP INNER JOIN FARE ON
FLIGHT_TRIP.FLIGHT_TRIP_ID=FARE.FLIGHT_TRIP_ID;
----------Example of ALTER table:
ALTER TABLE FARE ADD (CHECKING VARCHAR(25), CONSTRAINT FK
FOREIGN KEY(CHECKING) REFERENCES AIRPORT(AIRPORT_CODE));
---Example of Dropping constraints and columns:
ALTER TABLE FARE DROP CONSTRAINT FK;
ALTER TABLE FARE DROP COLUMN CHECKING;
---Example of UNION operation:
SELECT FNAME, LNAME FROM TRAVELLER WHERE ID IN(SELECT ID
FROM TRAVELLER_ITINERARY WHERE FLIGHT='kunish17dec')
UNION
SELECT FNAME, LNAME FROM TRAVELLER WHERE ID IN(SELECT ID FROM
TRAVELLER_ITINERARY WHERE FLIGHT='inder17dec');

--Example of DROP table command:

------------------------------
use Airlinesdb_new;
show tables;

select * from traveller_ticket inner join seat using(seat_no)  inner join fare using(flight_trip_id);

